<!-- vim: set ts=2 sw=2 noai et:-->
<!DOCTYPE html>
<html>
  <head>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
    <script src="aspect.js"></script>
    <script>
      var bird = new Interceptable({

        name: "birdy",

        fly: function(distance) {
          console.log(this.name, "flew", distance);
          return distance;
        },

        land: function(distance) {
          console.log(this.name, "landed", distance, "away");
          return distance;
        }

      });

      console.log("\n# before enhancement\n> bird.fly('1 km'); bird.land('1km');\n");
      bird.fly('1 km'); bird.land('1 km');

      (function enhance(primitive) {
        // fancy fly
        primitive.before('fly', function(distance) {
          console.log(this.name, "sung");
          console.log(this.name, "pepared to fly", distance);
          return arguments;
        });
        // fancy landing
        primitive.after(/l..d/, function(distance) {
          console.log(this.name, "sung again");
          return distance;
        });
        // automatic landing
        primitive.after(/f.y/, bird.land);
        // disable manual landing
        primitive.instead('land', function() {
          throw "No manual landing for " + this.name;
        });
      })(bird);

      console.log("\n# after enhancement\n> bird.fly('1 km');\n");
      bird.fly('1 km');
      console.log("\n> bird.land('1 km');\n");
      bird.land('1 km');
    </script>
  </head>
</html>
