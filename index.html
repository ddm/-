<!-- vim: set ts=2 sw=2 noai et:-->
<!DOCTYPE html>
<html>
  <head>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
    <script src="aspect.js"></script>
    <script>
      var original = {

        name: "original",

        fly: function(distance) {
          console.log(this.name, "flew", distance);
          return distance;
        },

        land: function(distance) {
          console.log(this.name, "landed", distance, "away");
          return distance;
        }

      };

      console.log("\n# before enhancement\n> original.fly('1 km'); original.land('1km');\n");
      original.fly('1 km'); original.land('1 km');

      var enhanced = (function enhance(bird) {
        var enhanced = new Interceptable(bird);
        enhanced.name = 'enhanced';
        // fancy fly
        enhanced.before('fly', function(distance) {
          console.log(this.name, "sung");
          console.log(this.name, "pepared to fly", distance);
          return arguments;
        });
        // fancy landing
        enhanced.after(/l..d/, function(distance) {
          console.log(this.name, "sung again");
          return distance;
        });
        // automatic landing
        enhanced.after(/f.y/, enhanced.land);
        // disable manual landing
        enhanced.instead('land', function() {
          throw "No manual landing for " + this.name;
        });
        return enhanced;
      })(original);

      console.log("\n# after enhancement\n> enhanced.fly('1 km');\n");
      enhanced.fly('1 km');
      console.log("\n> enhanced.land('1 km');\n");
      enhanced.land('1 km');
    </script>
  </head>
</html>
