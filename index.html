<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"/>
    <script src="_.js"></script>
    <script src="µ.js"></script>
    <script>
      var original = {
        name: "original",
        fly: function(distance) {
          console.log(this.name, "flew", distance);
          return distance;
        },
        land: function(distance) {
          console.log(this.name, "landed", distance, "away");
          return distance;
        }
      };

      var enhanced = (function enhance(bird) {
        var enhanced = µ(bird);
        enhanced.name = 'enhanced';
        // fancy flight
        enhanced.before('fly', function(distance) {
          console.log(this.name, "sang");
          console.log(this.name, "pepared to fly", distance);
        });
        // fancy landing
        enhanced.after(/l..d/, function(distance) {
          console.log(this.name, "sang again");
        });
        // automatic landing
        enhanced.after(/f.y/, enhanced.land);
        // disable manual landing
        enhanced.insteadOf('land', function() {
          throw "No manual landing for " + this.name;
        });
        return enhanced;
      })(original);

      console.log("\n# before enhancement\n> original.fly('1 km'); original.land('1km');\n");
      original.fly('1 km'); original.land('1 km');
      console.log("\n# after enhancement\n> enhanced.fly('1 km');\n");
      enhanced.fly('1 km');
      console.log("\n> enhanced.land('1 km');\n");
      try {
        enhanced.land('1 km');
      } catch (exception) {
        console.log(exception);
      }
      console.log("\n> enhanced.__proto__ === original;\n");
      console.log(enhanced.__proto__ === original);
    </script>
  </head>
</html>
<!-- vim: set ts=2 sw=2 noai et:-->
