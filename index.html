<!-- vim: set ts=2 sw=2 noai et:-->
<!DOCTYPE html>
<html>
  <head>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
    <script src="aspect.js"></script>
    <script>
      var bird = _.extend(Interceptable, {

        fly: function(distance) {
          console.log("flew", distance);
          return distance;
        },

        land: function(distance) {
          console.log("landed", distance, "away");
          return distance;
        }

      });

      console.log("# before enhancement > bird.fly('1 km')");
      bird.fly('1 km');

      (function enhance(primitive) {
        // fancy fly
        primitive.before('fly', function(distance) {
          console.log("sung");
          console.log("pepared to fly", distance);
          return arguments;
        });
        // fancy landing
        primitive.after(/l..d/, function(distance) {
          console.log("sung again");
          return distance;
        });
        // automatic landing
        primitive.after(/f.y/, bird.land);
        // disable manual landing
        primitive.before('land', function() {
          throw "No manual landing for you!"
        });
      })(bird);

      console.log("# after enhancement > bird.fly('1 km')");
      bird.fly('1 km');
      bird.land('1 km');
    </script>
  </head>
</html>
